<html lang="en"><!--<![endif]--><head>
    <meta charset="utf-8">

    <title>Ares Dashboard</title>

    <meta name="description" content="A multipurpose GroundComms &amp; Data Aquisition Software">
    <meta name="author" content="AryanRai">
    <meta name="robots" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.0">

    <!-- Favicons (just the basics for now, check out http://realfavicongenerator.net/ for all available) -->
    <link rel="shortcut icon" href="assets/img/favicon.png">
    <link rel="icon" type="image/png" href="assets/img/favicon.png" sizes="32x32">

    <!-- Web fonts -->
    <link rel="stylesheet" href="assets/fonts/Railway-OpenSans.css">

    <!-- Bootstrap and Ares CSS -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/animate.min.css">
    <link rel="stylesheet" href="assets/css/grid.css">
    <link rel="stylesheet" href="assets/css/ares.css">
    <link rel="stylesheet" href="assets/css/sidebar.css">
<script>

    var lockedpage = false;

    if ((lockedpage) == false) {
        
    function openNav() {
        document.getElementById("mySidenav").style.width = "350px";
    }

    function closeNav() {
        document.getElementById("mySidenav").style.width = "0px";
    }

    function openDeviceNav() {
        document.getElementById("myDevicenav").style.width = "350px";
        document.getElementById("myDevicenav").style.visibility = "all";
    }

    function closeDeviceNav() {
        document.getElementById("myDevicenav").style.width = "0px";
        document.getElementById("myDevicenav").style.visibility = "hidden";
    }
    
    }
    
    window.addEventListener('click', function(e){   
      if (!document.getElementById('mySidenav').contains(e.target) && !document.getElementById('myMenu').contains(e.target)){
        // Clicked in box
       document.getElementById("mySidenav").style.width = "0px";  
      } else{
       
     // document.getElementById("mySidenav").style.width = "0px";
      }
    });
    

    window.addEventListener('click', function(e){   
      if (!document.getElementById('myDevicenav').contains(e.target) && !document.getElementById('myDeviceMenu').contains(e.target)){
        // Clicked in box
       document.getElementById("myDevicenav").style.width = "0px";  
       document.getElementById("myDevicenav").style.visibility = "hidden";
      } else{
       
     // document.getElementById("mySidenav").style.width = "0px";
     document.getElementById("myDevicenav").style.visibility = "visible";
      }
    });

    </script></head>


    
    
    <body><div id="mySidenav" class="sidenav" onmouseleave="closeNav()" style="left: 0%; width: 0px;">
      <a href="index.html" class="nav-link">Dashboard</a>
      <a href="#" class="nav-link">Config</a>
      <a href="#" class="nav-link">Logs</a>
      <a href="#" class="nav-link">Terminal</a>
      <a href="#" class="nav-link">Comms</a>
      <a href="DAQ.html" class="nav-link">DAQ</a>
    </div>


    <div id="myDevicenav" class="sidenav" onmouseleave="closeDeviceNav()" style="left: 82%; width: 0px; visibility: hidden;">
        <a href="#" class="nav-link">WiFi</a>
        <a href="#" class="nav-link">Mavlink</a>
        <a href="#" class="nav-link">Bluetooth</a>
        <a href="#" class="nav-link">LabJack</a>
        <a href="#" class="nav-link">RS</a>
        <a href="#" class="nav-link">SSH</a>
        <a href="#" class="nav-link">LoRa</a>
      </div>
  




    <!-- Page Container -->
    <!--
        Available Classes: 'modern-sf', 'vintage-sf', 'interstellar-sf'
    -->
    <div id="page-container" class="modern-sf">
        <!-- Header -->
        <header id="page-header" class=" hidden-xs">
            <h1 class="h3 font-w200 ">
                <span class="text-crystal">//</span> <a onmouseover="openNav()" style="font-size:30px;cursor:pointer" class="link-sf font-w300" id="myMenu" onclick="openNav()">COMMS</a>
            </h1>
            


            <div class="h3 text-right pull-right hidden-xs">  
                <div class="text-crystal font-w300" style="font-size:30px;cursor:pointer" "="">                    <h1 class="h3 font-w200" text-right="" pull-right="">
                    <span class="text-crystal">//</span> <a onmouseover="openDeviceNav()" style="font-size:30px;cursor:pointer; position: relative;" class="link-sf font-w300" id="myDeviceMenu" onclick="openDeviceNav()">DEVICE_{}</a>
                </h1></div>

                <div id="device_status" class="text-danger animated infinite pulse pull-right">[LIVE]</div>
            </div>

        </header>
        <!-- END Header -->

        <!-- Main Content -->
        <main id="page-main">
            <!-- Columns -->
            <!-- partial:index.partial.html -->
<div id="container">
  
</div>

 <!-- make a button to add more boxes 
  <button id="add" onclick="createBox()">Add Box</button>-->
  
            <!-- END Columns -->

            <!-- Page Footer -->
            
            <!-- END Page Footer -->
        </main>
        <!-- END Main Content -->
    
    <!-- END Page Container -->

    <!-- Scripts -->
    <script src="assets/js/core/jquery.min.js"></script>
    <script src="assets/js/plugins/jquery.appear.min.js"></script>
    <script src="assets/js/plugins/jquery.countTo.min.js"></script>
    <script src="assets/js/plugins/jquery.easypiechart.min.js"></script>
    <script src="assets/js/ares.js"></script>

    <!-- Page JS Code -->
    <script>
        jQuery(function(){
            // Init page helpers (Appear + CountTo + Easy Pie Chart plugins)
            Ares.initHelpers(['appear', 'appear-countTo', 'easy-pie-chart']);
        });
    </script>





<!-- partial -->

<script src="/assets/js/plugins/jquery.min.js"></script>
<script src='/assets/js/plugins/TweenMax.min.js'></script>
<script src='/assets/js/plugins/Draggable.min.js'></script>

<script src="/assets/js/custom/grid.js"></script>




<script
src="/assets/js/plugins/Chart.js">
</script>

<script>
 




createBox('<div class="block-header"><h2 id="pywebview-status" class="block-title animated fadeInDown"><i>Backend</i> is not ready</h2></div><div class="block-content"><button onClick="initLMJ()">Connect Device</button><br/></div>');



createBox('<br><label for="disablelongpreview">Disable msg preview for running > 10 mins:</label><input type="checkbox" id="disablelongpreview" name="disablelongpreview" value="" checked><br><label for="disableautograph">Disable auto graphing, for running > 10 mins:</label><input type="checkbox" id="disableautograph" name="disableautograph" value="" checked><br><button onClick="startreading()">Start Logging</button><br/><label for="relay_input">Toggle Valve:</label><input id="relay_input" placeholder="set valve state here open/close"><button onClick="changerelay()">Toggle Valve</button><br/><button onClick="closedevice()">Stop Reading & Close connection</button><br/>')


createBox('<button onClick="CreateLog()">Generate Log & Plot</button><br/><button onClick="GetLog()">Finalize Log & Preview</button><br/><label for="dfname">savefile:</label><input id="dfname" placeholder="csv name (dont forget .csv)"><button onClick="savefile()">Save</button><br/>')

createBox('<div id="response-container"></div>');
createBox('<div><canvas id="line-chart" width="800" height="450"></canvas></div>');

</script>

<script>

initialized = false
reading = false
var graphrefresh = null

document.getElementById('disableautograph').addEventListener('change', checkgraph);

function checkgraph(){
    if (document.getElementById('disableautograph').checked) {
        clearInterval(graphrefresh);
    }

    if (initialized == false && reading == false) {
        graphrefresh = setInterval(function() {
            //CreateLog()
            clearInterval(graphrefresh);
        }, 1000)
    }

    if (document.getElementById('disableautograph').checked != true && initialized == true && reading == true) {
        graphrefresh = setInterval(function() {
            CreateLog()
        }, 1000)
    }

}

  window.addEventListener('pywebviewready', function() {
      var container = document.getElementById('pywebview-status')
      container.innerHTML = '<i>backend</i> is ready'
  })

  function showResponse(response) {
      var container = document.getElementById('response-container')

      container.innerText = response.message
      container.style.display = 'block'
  }

  function setStatus(status, color='yellow') {
      var container = document.getElementById('device_status')

      container.innerText = status
      //container.style.display = 'block'
      container.style.color = color
  }

  function DisplayChart(response) {
      
      //alert(response.message)
      //alert(response.message)
      json_data = JSON.parse(response.message)
      time_data = json_data['timestamp']
      A0_data = json_data['A0']
      A1_data = json_data['A1']
      VoltageDiff = json_data['VoltageDiff']
      //Pressure = json_data['Pressure']

      var ctx = document.getElementById('line-chart').getContext('2d');
      var myChart = new Chart(ctx, {
          type: 'line',
          data: {
              labels: time_data,
              datasets: [{
                  label: 'A0',
                  data: A0_data,
                  backgroundColor: '#46cdba',
                  borderColor: '#46cdba',
                  borderWidth: 1
              },
              {
                  label: 'A1',
                  data: A1_data,
                  backgroundColor: '#46d190',
                  borderColor: '#46d190',
                  borderWidth: 1
              }
              ,
              {
                  label: 'VoltageDiff',
                  data: VoltageDiff,
                  backgroundColor: '#46d190',
                  borderColor: '#46d190',
                  borderWidth: 1
              }]
          },
          options: {
              scales: {
                  yAxes: [{
                      ticks: {
                          beginAtZero: true
                      }
                  }]
              }
          }
      });
      
  }

  function initialize() {
      pywebview.api.init().then(
          function(response) {
              showResponse(response)
              setStatus('Waiting', 'Red')
          }
      )
  }

/*
  function doHeavyStuff() {
      var btn = document.getElementById('heavy-stuff-btn')

      pywebview.api.heavy_stuff.doHeavyStuff().then(function(response) {
          showResponse(response)
          btn.onclick = doHeavyStuff
          btn.innerText = 'Perform a heavy operation'
      })

      showResponse({message: 'Working...'})
      btn.innerText = 'Cancel the heavy operation'
      btn.onclick = cancelHeavyStuff
  }

  function cancelHeavyStuff() {
      pywebview.api.heavy_stuff.cancelHeavyStuff()
  }

  function getRandomNumber() {
      pywebview.api.getRandomNumber().then(showResponse)
  }

  function greet() {
      var name_input = document.getElementById('name_input').value;
      pywebview.api.sayHelloTo(name_input).then(showResponse)
  }
*/
  function catchException() {
      pywebview.api.LJM.catch(showResponse)
  }



  function CreateLog() {
      pywebview.api.Module_Labjack.createLog().then(function(response) {
          DisplayChart(response);
          response = {message: 'Log Created & Plotted'}
          showResponse(response);

          //setStatus('Logged', 'Green')
      })
  }

  function initLMJ() {
      pywebview.api.Module_Labjack.initLMJ().then(
          function(response) {
              showResponse(response)
              setStatus('Connected', 'Green')
              initialized = true
          }
      )
  }
  
  function startreading() {
      pywebview.api.Module_Labjack.StartRead().then(
          function(response) {
              showResponse(response)
              setStatus(response.message, 'Yellow')
              reading = true

            //every 1 seconds create graph

            //call the function every 1 second
            
            checkgraph()
            }
      )
  }


  function changerelay() {
      var relay_input = document.getElementById('relay_input').value;
      if (relay_input == "") {
          relay_input = 0
      }
      if (relay_input == "open") {
          relay_input = 1
      }
      if (relay_input == "close") {
          relay_input = 0
      }
      pywebview.api.Module_Labjack.ToggleRelay(relay_input).then(
          function(response) {
              showResponse(response)
              //setStatus('Toggled', 'Green')
          }
      )
  }

  function closedevice() {
      pywebview.api.Module_Labjack.CloseDevice().then(
          function(response) {
              showResponse(response)
              setStatus('Closed', 'Red')
                initialized = false
                reading = false
                checkgraph()
          }
      )
      
  }



  function GetLog() {
      response =  ""
      var longpreview = document.getElementById('disablelongpreview').checked;
      pywebview.api.Module_Labjack.createDF(longpreview).then( function(response) {
    showResponse(response);
        
      })
  }

  function savefile () {
      var dfname = document.getElementById('dfname').value;
      pywebview.api.Module_Labjack.saveDF(dfname).then(showResponse)
  }

  

</script>


</div>

</body></html>