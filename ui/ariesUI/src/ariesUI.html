<!DOCTYPE html>
<html lang="en">


<!-- Draggable DIV -->
<div id="mydiv">
  <!-- Include a header DIV with the same name as the draggable DIV, followed by "header" -->
  <button id="mydivheader" class="btn btn-xs">#</button>
  <details open class="dropdown">
    
    <summary class="btn-outline" >Expand</summary>
  <div id='cssmenu'>
    <ul class="menu lg:menu-horizontal bg-base-200 rounded-box lg:mb-64">
      <li>
        <details>
          <summary>File</summary>
          <ul>
            <li><a class="btn btn-ghost" id="save-btn" href="#">Save</a></li>
            <li><a class="btn btn-ghost" id="destroy-btn" href="#">Destroy</a></li>
            <li><a class="btn btn-ghost" id="create-btn" href="#">Create</a></li>
          </ul>
        </details>
      </li>
      <li>
        <details>
          <summary>Insert</summary>
          <ul>
            <li><div class="btn">
              <!-- manually force a drop size of 2x2 for nested size -->
              <div class="grid-stack-item" gs-w="2" gs-h="1" id="nestedpress">
                <div class="grid-stack-item-content" id="nesteddrag">Nest</div>
              </div>


              
            </div></li>

            <li><div class="sidebar">
              <!-- manually force a drop size of 2x2 for nested size -->
              <div class="grid-stack-item" gs-w="2" gs-h="1" id="widgetpress" contentEditable="true">
                <div class="grid-stack-item-content" id="widgetdrag">Widget</div>
              </div>
              
            </div></li>


            <li><div class="sidebar">
              <!-- manually force a drop size of 2x2 for nested size -->
              <div class="grid-stack-item" gs-w="2" gs-h="1" id="">
                <div class="grid-stack-item-content" id=""> 
                  <button class="chuncky-btn" onClick="grid.removeWidget(this.parentNode.parentNode)">X</button>
                  <!-- Open the modal using ID.showModal() method -->
                  <button class="grid-stack-item-id chuncky-btn" onClick="console.log('self id is:')">id:</button>
                  <button class="chuncky-btn" onclick="my_modal_2.showModal()">Configurator</button>
                  <br>
                  
                </div>
              </div>
            </div></li>



           
            <dialog id="my_modal_2" class="modal">
              <div class="modal-box">
                <h3 class="text-lg font-bold">Configurator</h3>
                <p class="py-4">Add/select stream for grid-id</p>
                {<input id="App-Configurator-select-grid-select"></input>}
                <details>
                  <summary id="App-Configurator-active-grids-dropdown">Grids</summary>
                  
                    <ul class="menu menu-xs bg-base-200 rounded-lg " id="App-Configurator-active-grids-dropdown-content">
                    </ul>
                
                  </details>
                  
                  <p class="py-4">Select Widget Type</p>
                  {<input id="App-Configurator-select-WidgetType-input"></input>}
                  <details>
                    <summary id="App-Configurator-active-WidgetType-dropdown">Type</summary>
                    
                      <ul class="menu menu-xs bg-base-200 rounded-lg " id="App-Configurator-active-WidgetType-dropdown-content">
                      </ul>
                  
                  </details>
              
                <p class="py-4">Current Stream {}</p>
                
                <input id="App-Configurator-select-stream-input" class="width-inherit">
                <details>
                  <summary id="App-Configurator-active-streams-dropdown">Streams</summary>
                  
                    <ul class="menu menu-xs bg-base-200 rounded-lg " id="App-Configurator-active-streams-dropdown-content">
                    </ul>
                
                  </details>
                  <button class="btn" id="App-Configurator-save-btn">Save</button>
                </div>
                <form method="dialog" class="modal-backdrop">
                  <button type="submit">close</button>
                </form>
              </dialog>


              <li><div class="trash" id="trash">Drop to remove</div></li>
            </ul>
          </details>
        </li>
        <li>
          <details>
            <summary>Load</summary>
            <ul>
              <li><a class="btn btn-ghost" id="save-list-btn" href="#">Save list</a></li>
              <li><a class="btn btn-ghost" id="save-no-content-btn" href="#">Save no content</a></li>
              <li><a class="btn btn-ghost" id="clear-btn" href="#">Clear</a></li>
              <li><a class="btn btn-ghost" id="load-btn" href="#">Load</a></li>
            </ul>
          </details>
        </li>
        <li>
          <details>
            <summary>AriesMods</summary>
            <div id="ariesModsDropZone" class="aries-mods-drop-zone">
              <div class="drop-zone-inner">
                <div class="drop-zone-content">
                  <i class="text-2xl">ðŸ“¦</i>
                  <p>Drag and drop AriesMod (.js) files here</p>
                  <p class="text-sm">or</p>
                  <button class="btn btn-sm" onclick="document.getElementById('ariesModFileInput').click()">
                    Browse Files
                  </button>
                  <input type="file" id="ariesModFileInput" accept=".js" style="display: none;" />
                </div>
              </div>
              <div id="installedMods" class="installed-mods">
                <h4 class="text-sm font-bold mt-2">Installed Mods</h4>
                <ul id="ariesModsList" class="text-sm"></ul>
              </div>
            </div>
          </details>
        </li>
      </ul>
      </div>
      </details>
</div>


<head>
  <script src="./assets/js/core/jquery.min.js"></script>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>dash</title>
  <link rel="stylesheet" href="./assets/css/gridstackdemo.css"/>
  <link href="./assets/node_modules/gridstack/dist/gridstack-extra.min.css" rel="stylesheet"/>
  <script src="./assets/node_modules/gridstack/dist/gridstack-all.js"></script>
<!--<link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" /> -->
  <link href="../node_modules/daisyui/dist/full.css" rel="stylesheet" type="text/css" />
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link href="./assets/css/toolbar.css" rel="stylesheet" type="text/css" />
  <script src="./assets/js/custom/toolbar.js"></script>

  <script src="./assets/js/custom/gridstackevents.js"></script>

  <link href="./assets/css/aresv2.css" rel="stylesheet" type="text/css" />

  <link href="./assets/css/electron.css" rel="stylesheet" type="text/css" />

  <link rel="stylesheet" href="assets/css/sidebar.css">
  <link rel="stylesheet" href="assets/css/animate.min.css">
  <script src="./assets/js/custom/sidebar.js" defer></script>

  <!-- Web fonts -->
  <link rel="stylesheet" href="./assets/fonts/Railway-OpenSans.css">

  <!-- Add these new stylesheets -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.css" /> -->
</head>
<body>
  <div id="app"></div> <!-- React will render here -->
  <div id="page-container" class="modern-sf">

<marquee direction="left" speed="normal" behavior="loop" class="marquee top-bar h-5 cursor-grab" id="AriesUI-app-scroll-status">
  Status {}
</marquee>
<header id="header-main">`

  <div class="navbar">
    <div class="flex-1">
      <div class="flex-1 on-top text-3xl main-title"><span>// </span><a class="link-sf" id="title-main" onclick="openNav()">comms</a></div>
    </div>
    <div class="flex-none">
      <ul class="menu menu-horizontal px-1">
        <li class="on-top">
          <details>
            <summary id="SH-active-streams-dropdown">Streams</summary>
            
              <ul class="menu menu-xs bg-base-200 rounded-lg " id="SH-active-streams-dropdown-content">
                </ul>
            
            </details>
          </li>
          <li class="on-top">
            <details>
              <summary class="text animated infinite pulse pull-right" id="App-live-status-dropdown"><a>[Link]</a></summary>
              <ul>
                <li>
                  <details>
                    <summary id="SH-live-status" class="text animated infinite pulse pull-right">StreamHandler</summary>
                    <ul>
                      <li><a id="Itf-connect-btn">Connect</a></li>
                      <li><a id="Itf-close-btn">Disconnect</a></li>
                      <li><label class="label-text">Reconnect</label><input type="checkbox" class="toggle" checked="checked" id="Itf-reconnect-btn"/></li>
                      
                    </ul>
                  </details>
                  <details>
                    <summary>ariesUI</summary>
                    <ul>
                      <li><a>Connect</a></li>
                      <li><a>Disconnect</a></li>
                    </ul>
                  </details>
                  <details>
                    <summary>Engine</summary>
                    <ul>
                      <li><a>Connect</a></li>
                      <li><a>Disconnect</a></li>
                    </ul>
                  </details>
                </li>
              </ul>
            </details>
          </li>
          
          <li class="on-top">
            <details>
              <summary>Device</summary>
              <ul>
                <li><a>Submenu 1</a></li>
                <li><a>Submenu 2</a></li>
                <li>
                  <details open>
                    <summary>Parent</summary>
                    <ul>
                      <li><a>item 1</a></li>
                      <li><a>item 2</a></li>
                    </ul>
                  </details>
                </li>
              </ul>
            </details>
          </li>
        </ul>
      </div>
    </div>
   </header>
  <div id="mySidenav" class="sidenav" onmouseleave="closeNav()" style="left: 0%; width: 0px;">
    <a href="dashv1.html" class="nav-link">Dashboard</a>
    <a href="#" class="nav-link">Config</a>
    <a href="#" class="nav-link">Logs</a>
    <a href="#" class="nav-link" onclick="openTerminal()">Terminal</a>
    <a href="#" class="nav-link">Comms</a>
    <a href="DAQ.html" class="nav-link">DAQ</a>
    <a href="ariesMods.html" class="nav-link">AriesMods</a>
  </div>

  <!-- Add this terminal dialog -->
<dialog id="terminal-modal" class="modal">
  <div class="modal-box w-11/12 max-w-5xl h-[80vh]">
    <h3 class="font-bold text-lg">Terminal</h3>
    <div id="terminal-container" class="bg-black text-green-500 p-4 h-[90%] overflow-y-auto font-mono">
      <div id="terminal-output"></div>
      <div class="terminal-input-line">
        <span class="terminal-prompt">></span>
        <input type="text" id="terminal-input" class="bg-transparent border-none outline-none text-green-500 w-[90%]">
      </div>
    </div>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>

  <div id="myDevicenav" class="sidenav" onmouseleave="closeDeviceNav()" style="left: 82%; width: 0px; visibility: hidden;">
      <a href="#" class="nav-link">WiFi</a>
      <a href="#" class="nav-link">Mavlink</a>
      <a href="#" class="nav-link">Bluetooth</a>
      <a href="#" class="nav-link">LabJack</a>
      <a href="#" class="nav-link">RS</a>
      <a href="#" class="nav-link">SSH</a>
      <a href="#" class="nav-link">LoRa</a>
    </div>
  </div>
  <div class="container-fluid">

    <!-- Main map/terrain overview

     -->
    <!-- Sensor values -->

    
    <!-- Graphs -->

    
    <!-- Add more grid items as needed -->
  </div>
  
  <!-- Status bar -->
  <div class="status-bar">
    <span id="status-message">System Status: Operational</span>
    <span id="current-time"></span>
  </div>

  <script type="module">
    import { initializeGrid, addWidget, addNested, setupDragIn } from './assets/js/custom/gridManager.js';
  
    const grid = initializeGrid('.container-fluid');
  
    document.getElementById('nestedpress').addEventListener('click', () => addNested(grid));
    document.getElementById('widgetpress').addEventListener('click', () => addWidget(grid));

    
  
    setupDragIn('.sidebar .grid-stack-item');
  </script>
  

  <!-- logic -->
  <script src="./assets/js/logic/stream_interface.js" defer></script>

  <!-- vanilla reacivity -->
  <script src="./assets/js/custom/ariesUI.js" type="module"></script>
      
  <!-- Load React Bundle -->
  <script src="./assets/js/core/bundle.js"></script>


  <!-- Add these new scripts -->
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

  <script>
    // Override console.log
    const originalConsoleLog = console.log;
    console.log = function() {
      // Call original console.log
      originalConsoleLog.apply(console, arguments);
      
      // Add to terminal
      const timestamp = new Date().toISOString();
      const message = Array.from(arguments).join(' ');
      addTerminalMessage(timestamp, message);
    };

    function addTerminalMessage(timestamp, message) {
      const terminal = document.getElementById('terminal-output');
      const messageElement = document.createElement('div');
      messageElement.className = 'terminal-message';
      messageElement.innerHTML = `<span class="terminal-timestamp">[${timestamp}]</span> ${message}`;
      terminal.appendChild(messageElement);
      
      // Auto scroll to bottom
      terminal.scrollTop = terminal.scrollHeight;
    }

    function openTerminal() {
      document.getElementById('terminal-modal').showModal();
      document.getElementById('terminal-input').focus();
    }

    // Handle terminal input
    document.getElementById('terminal-input').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        const command = this.value;
        
        // Add command to output
        addTerminalMessage(new Date().toISOString(), `$ ${command}`);
        
        try {
          // Evaluate command and log result
          const result = eval(command);
          if (result !== undefined) {
            console.log(result);
          }
        } catch (error) {
          console.log('Error:', error.message);
        }
        
        // Clear input
        this.value = '';
      }
    });

    // Keep terminal scrolled to bottom when new content is added
    const terminalOutput = document.getElementById('terminal-output');
    const observer = new MutationObserver(() => {
      terminalOutput.scrollTop = terminalOutput.scrollHeight;
    });
    
    observer.observe(terminalOutput, {
      childList: true,
      subtree: true
    });
  </script>

  <style>
    .aries-mods-drop-zone {
      width: 300px;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.05);
      border-radius: 8px;
    }

    .drop-zone-inner {
      border: 2px dashed #ccc;
      border-radius: 6px;
      padding: 1.5rem;
      text-align: center;
      transition: all 0.3s ease;
    }

    .drop-zone-inner.drag-over {
      background: rgba(0, 0, 0, 0.1);
      border-color: #666;
    }

    .drop-zone-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }

    .installed-mods {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid #eee;
    }

    #ariesModsList {
      list-style: none;
      padding: 0;
      margin: 0.5rem 0;
    }

    #ariesModsList li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.25rem 0;
    }
  </style>

  <!-- Add before the closing body tag -->
  <script>
    // AriesMods Drop Zone functionality
    const dropZone = document.getElementById('ariesModsDropZone');
    const dropZoneInner = dropZone.querySelector('.drop-zone-inner');
    const fileInput = document.getElementById('ariesModFileInput');
    const modsList = document.getElementById('ariesModsList');

    // Prevent default drag behaviors
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      dropZone.addEventListener(eventName, preventDefaults, false);
      document.body.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults (e) {
      e.preventDefault();
      e.stopPropagation();
    }

    // Highlight drop zone when dragging over it
    ['dragenter', 'dragover'].forEach(eventName => {
      dropZoneInner.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
      dropZoneInner.addEventListener(eventName, unhighlight, false);
    });

    function highlight(e) {
      dropZoneInner.classList.add('drag-over');
    }

    function unhighlight(e) {
      dropZoneInner.classList.remove('drag-over');
    }

    // Handle dropped files
    dropZone.addEventListener('drop', handleDrop, false);
    fileInput.addEventListener('change', handleFileSelect, false);

    function handleDrop(e) {
      const dt = e.dataTransfer;
      const files = dt.files;
      handleFiles(files);
    }

    function handleFileSelect(e) {
      const files = e.target.files;
      handleFiles(files);
    }

    function handleFiles(files) {
      [...files].forEach(file => {
        if (file.name.endsWith('.js')) {
          // Here you would typically process the file
          // For now, we'll just add it to the list
          addModToList(file.name);
          console.log(`Processing AriesMod: ${file.name}`);
        } else {
          console.warn('Only .js files are supported for AriesMods');
        }
      });
    }

    function addModToList(modName) {
      const li = document.createElement('li');
      li.innerHTML = `
        <span>${modName}</span>
        <button class="btn btn-xs btn-ghost" onclick="this.parentElement.remove()">Ã—</button>
      `;
      modsList.appendChild(li);
    }
  </script>

</body>
</html>
